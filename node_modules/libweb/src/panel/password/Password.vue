<template>
    <b-card :title="$t('title')">
        <b-card-text>
            <b-form-group
                :label="$t('current-password')"
                label-for="current-password"
                :state="currentPasswordState"
                :invalid-feedback="invalidCurrentPassword"
                label-cols-md="3"
                label-cols-lg="2"
                label-align-md="right"
            >
                <b-form-input id="current-password" type="password" v-model="currentPassword" trim dir="ltr"></b-form-input>
            </b-form-group>
            <b-form-group
                :label="$t('new-password')"
                label-for="new-password"
                :state="newPasswordState"
                :invalid-feedback="invalidNewPassword"
                label-cols-md="3"
                label-cols-lg="2"
                label-align-md="right"
            >
                <b-form-input id="new-password" type="password" v-model="newPassword" trim dir="ltr"></b-form-input>
            </b-form-group>
            <b-form-group
                :label="$t('confirm-new-password')"
                label-for="confirm-new-password"
                :state="confirmNewPasswordState"
                :invalid-feedback="invalidConfirmNewPassword"
                label-cols-md="3"
                label-cols-lg="2"
                label-align-md="right"
            >
                <b-form-input id="confirm-new-password" type="password" v-model="confirmNewPassword" trim dir="ltr"></b-form-input>
            </b-form-group>
            <b-button variant="success" class="mt-3" block :disabled="saving" @click="save">{{$t('save')}}</b-button>
        </b-card-text>
    </b-card>
</template>


<script>
import loc from './Password.i18n.json';
import { i18n } from "../../utility/VueI18n";
export default {
    i18n: i18n(loc),
    data() {
        return {
            currentPassword: '',
            newPassword: '',
            confirmNewPassword: '',
            saving: false
        };
    },
    methods: {
        async save() {
            try {
                this.saving = true;
                await this.$api.post('/api/usermanager/Profile/SetPassword', {
                    currentPassword: this.currentPassword,
                    password: this.newPassword,
                    passwordConfirm: this.confirmNewPassword
                });
                this.toastSuccess();
                this.currentPassword = this.newPassword = this.confirmNewPassword = '';
            } catch (error) {
                this.toastError(error);
                console.error(error);
            } finally {
                this.saving = false;
            }
        }
    },
    computed: {
        currentPasswordState() {
            return this.currentPassword === undefined || this.currentPassword === null || this.currentPassword.length === 0 ? false : true;
        },
        invalidCurrentPassword() {
            if (this.currentPasswordState) {
                return '';
            }
            return this.$t('invalidCurrentPassword');
        },
        newPasswordState() {
            return this.newPassword === undefined || this.newPassword === null || this.newPassword.length === 0 ? false : true;
        },
        invalidNewPassword() {
            if (this.newPasswordState) {
                return '';
            }
            return this.$t('invalidNewPassword');
        },
        confirmNewPasswordState() {
            return this.confirmNewPassword === undefined || this.confirmNewPassword === null || this.confirmNewPassword.length === 0 ? false : true;
        },
        invalidConfirmNewPassword() {
            if (this.confirmNewPasswordState) {
                return '';
            }
            return this.$t('invalidConfirmNewPassword');
        }
    }
}
</script>