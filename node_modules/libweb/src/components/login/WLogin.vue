<template>
    <div>
        <center v-if="imageVisible && imagePath !== undefined">
            <b-card-img :src="imagePath" top class="mb-3" style="max-width: 300px"></b-card-img>
        </center>
        <b-tabs
            content-class="m-2"
            fill
            pills
            card
            v-model="tab"
            :active-nav-item-class="activeLinkClass"
        >
            <b-tab active :title-link-class="titleLinkClass">
                <template v-slot:title>
                    <w-mdi value="login">
                        <strong>{{$t('login-tab-title')}}</strong>
                    </w-mdi>
                </template>
                <div class="row">
                    <div class="col-12 col-md-8 col-lg-6 offset-md-2 offset-lg-3">
                        <sign-in :return-url="returnUrl"></sign-in>
                    </div>
                </div>
            </b-tab>
            <b-tab v-if="_email || _sms" :title-link-class="titleLinkClass">
                <template v-slot:title>
                    <w-mdi value="account-plus">
                        <strong>{{$t('register-tab-title')}}</strong>
                    </w-mdi>
                </template>
                <div class="row">
                    <div class="col-12 col-md-8 col-lg-6 offset-md-2 offset-lg-3">
                        <register
                            :can-register-with-email="_email"
                            :can-register-with-phone="_sms"
                            :username-required="usernameRequired"
                            @done="refreshPage"
                        ></register>
                    </div>
                </div>
            </b-tab>
            <b-tab v-if="_email || _sms" :title-link-class="titleLinkClass">
                <template v-slot:title>
                    <w-mdi value="lock-reset">
                        <strong>{{$t('recover-password-tab-title')}}</strong>
                    </w-mdi>
                </template>
                <div class="row">
                    <div class="col-12 col-md-8 col-lg-6 offset-md-2 offset-lg-3">
                        <reset-password
                            :can-reset-password-with-email="_email"
                            :can-reset-password-with-phone="_sms"
                            @done="refreshPage"
                        ></reset-password>
                    </div>
                </div>
            </b-tab>
        </b-tabs>
        <b-card-footer>
            <center v-show="showReturnToHomeLink">
                <a class="mx-3" :class="linkClass" href="/">{{$t('return-to-home-label')}}</a>
            </center>
        </b-card-footer>
    </div>
</template>
<script>
import SignIn from './SignIn.vue';
import ResetPassword from './ResetPassword.vue';
import Register from './Register.vue';
import loc from './WLogin.i18n.json';
import { i18n } from "../../utility/VueI18n";
export default {
    components: {
        SignIn,
        ResetPassword,
        Register
    },
    i18n: i18n(loc),
    props: {
        loginTabTitle: {
            default: ''
        },
        imagePath: {
            default: undefined
        },
        imageVisible: {
            default: false
        },
        returnUrl: {
            default: ''
        },
        verificationCodeSendersStatus: {
            default() {
                return {
                    email: false,
                    sms: false
                };
            }
        },
        showReturnToHomeLink: {
            default: false
        },
        usernameRequired: {
            default: true
        },
        titleLinkClass: {
            default() {
                return [];
            }
        },
        activeLinkClass: {
            default() {
                return [];
            }
        },
        linkClass: {
            default() {
                return [];
            }
        }
    },
    data() {
        return {
            tab: 0,
        };
    },
    methods: {
        refreshPage() {
            setTimeout(() => {
                window.location.reload(true);
            }, 1500);
        }
    },
    computed: {
        _sms() {
            return this.verificationCodeSendersStatus.sms;
        },
        _email() {
            return this.verificationCodeSendersStatus.email;
        }
    }
}
</script>